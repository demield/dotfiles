#!/bin/sh

if [ "$XDG_SESSION_DESKTOP" == "i3" ]; then
  OB_FILE="/tmp/pipe.xob"
else
  OB_FILE="$SWAYSOCK.wob"
fi

show_ob() {
  sink=$(pactl info | sed -En 's/Default Sink: (.*)/\1/p')
  pactl list sinks \
    | perl -000ne "if(/$sink/){/(Volume:.*(\s([0-9]+)\%).*)/; print \"\$3\n\"}" > "$OB_FILE"
}

case "$1" in
  up)
    pactl set-sink-volume @DEFAULT_SINK@ +5% && show_ob ;;
  down)
    pactl set-sink-volume @DEFAULT_SINK@ -5% && show_ob ;;
esac

unset OB_FILE

